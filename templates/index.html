<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FD Alerts — Dashboard</title>
  <link rel="stylesheet" href="/static/styles.css" />
  <style>
    .tabs { display:flex; justify-content:center; margin-bottom:15px; }
    .tab-btn { background:#333; color:#ccc; padding:8px 16px; border:none; cursor:pointer; }
    .tab-btn.active { background:#555; color:#fff; }
    .tab-content { display:none; }
    .tab-content.active { display:block; }
    .contacts-list label { display:block; margin:4px 0; }
  </style>
  <script>
    function switchTab(tab) {
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.getElementById(tab + '-tab').classList.add('active');
      document.getElementById(tab).classList.add('active');
    }
    window.onload = () => switchTab('send');
  </script>
</head>
<body>
  <div class="container">
    <div class="tabs">
      <button class="tab-btn active" id="send-tab" onclick="switchTab('send')">Αποστολή</button>
      <button class="tab-btn" id="contacts-tab" onclick="switchTab('contacts')">Επαφές</button>
      <button class="tab-btn" id="logs-tab" onclick="switchTab('logs')">Ιστορικό</button>
    </div>

    <h1>FD Alerts</h1>
    <p>Θύρα: {{ port }} • {{ version }}</p>

    <!-- Αποστολή -->
    <div id="send" class="tab-content active">
      <form method="POST">
        <fieldset>
          <legend>Κανάλι ειδοποίησης</legend>
          <label><input type="radio" name="channel" value="sms" checked> SMS (Yuboto OMNI)</label>
          <p class="hint">Πάροχος: {{ sms_provider or '—' }}</p>
        </fieldset>

        <fieldset>
          <legend>Επιλογή επαφών</legend>
          <div class="contacts-list">
            {% for c in contacts %}
              <label>
                <input type="checkbox" name="contacts" value="{{ c.phone }}"> {{ c.name }} ({{ c.phone }})
              </label>
            {% endfor %}
          </div>
        </fieldset>

        <label for="message">Μήνυμα</label>
        <textarea id="message" name="message" rows="4" placeholder="Πληκτρολόγησε το μήνυμα..."></textarea>

        <button type="submit">Αποστολή</button>
      </form>

      {% if status %}
        <div class="status {{ 'ok' if ok else 'error' }}">{{ status }}</div>
      {% endif %}
    </div>

    <!-- Επαφές -->
    <div id="contacts" class="tab-content">
      <h2>Επαφές</h2>
      <p>Οι επαφές αποθηκεύονται στο <code>/data/contacts.json</code>.</p>
      <pre>{{ contacts|tojson(indent=2) }}</pre>
    </div>

    <!-- Ιστορικό -->
    <div id="logs" class="tab-content">
      <h2>Ιστορικό Αποστολών</h2>
      {% if logs %}
        <ul>
          {% for l in logs[-10:] %}
            <li><strong>{{ l.channel }}</strong>: {{ l.message[:60] }}... ({{ l.contacts|join(', ') }})</li>
          {% endfor %}
        </ul>
      {% else %}
        <p>Δεν υπάρχουν ακόμα αποστολές.</p>
      {% endif %}
    </div>

    <footer><small>FD Alerts • Flask • SMS</small></footer>
  </div>
</body>
</html>
